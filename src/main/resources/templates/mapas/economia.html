<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Análisis de Impacto Económico - SismoMex</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    <style>
        .map-container {
            height: 600px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        .economic-card {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            color: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .impact-indicator {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        .chart-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-globe-americas me-2"></i>SismoMex
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/">Inicio</a>
                <a class="nav-link" href="/mapas">Análisis</a>
                <a class="nav-link active" href="/mapas/economia">Economía</a>
            </div>
        </div>
    </nav>

    <div class="container-fluid py-4">
        <div class="row">
            <div class="col-12">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h1><i class="fas fa-dollar-sign text-success me-3"></i>Análisis de Impacto Económico</h1>
                    <a href="/mapas" class="btn btn-outline-secondary">
                        <i class="fas fa-arrow-left me-2"></i>Volver a Análisis
                    </a>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Panel de Estadísticas Económicas -->
            <div class="col-lg-3">
                <div class="economic-card">
                    <h5><i class="fas fa-chart-line me-2"></i>Indicadores Económicos</h5>
                    <div class="impact-indicator mt-3">
                        <h3>$2.5T</h3>
                        <p class="mb-0">PIB Total Analizado</p>
                    </div>
                    <div class="mt-3">
                        <p><strong>Estados Económicamente Vulnerables:</strong></p>
                        <ul class="list-unstyled">
                            <li><i class="fas fa-circle text-danger me-2"></i>Oaxaca: $45B PIB</li>
                            <li><i class="fas fa-circle text-warning me-2"></i>Guerrero: $38B PIB</li>
                            <li><i class="fas fa-circle text-warning me-2"></i>Chiapas: $42B PIB</li>
                            <li><i class="fas fa-circle text-info me-2"></i>Michoacán: $67B PIB</li>
                        </ul>
                    </div>
                    <div class="mt-4">
                        <h6>Distribución del Riesgo Económico:</h6>
                        <div class="progress mb-2">
                            <div class="progress-bar bg-danger" style="width: 25%">Alto Riesgo: 25%</div>
                        </div>
                        <div class="progress mb-2">
                            <div class="progress-bar bg-warning" style="width: 35%">Riesgo Moderado: 35%</div>
                        </div>
                        <div class="progress">
                            <div class="progress-bar bg-success" style="width: 40%">Bajo Riesgo: 40%</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header bg-success text-white">
                        <h6><i class="fas fa-filter me-2"></i>Filtros Económicos</h6>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label">Sector Económico</label>
                            <select class="form-select">
                                <option>Todos los sectores</option>
                                <option>Manufactura</option>
                                <option>Servicios</option>
                                <option>Turismo</option>
                                <option>Agricultura</option>
                                <option>Minería</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Nivel de PIB</label>
                            <select class="form-select">
                                <option>Todos los niveles</option>
                                <option>PIB Alto (>$100B)</option>
                                <option>PIB Medio ($50B-$100B)</option>
                                <option>PIB Bajo (<$50B)</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Vulnerabilidad Sísmica</label>
                            <select class="form-select">
                                <option>Todas las vulnerabilidades</option>
                                <option>Alta vulnerabilidad</option>
                                <option>Vulnerabilidad moderada</option>
                                <option>Baja vulnerabilidad</option>
                            </select>
                        </div>
                        <button class="btn btn-success w-100">
                            <i class="fas fa-search me-2"></i>Actualizar Análisis
                        </button>
                    </div>
                </div>

                <!-- Gráfico de Tendencias -->
                <div class="chart-container mt-3">
                    <h6 class="text-center mb-3">Pérdidas Económicas por Sismos</h6>
                    <!--<canvas id="economicChart" width="250" height="150"></canvas>-->
                </div>
            </div>

            <!-- Mapa Principal -->
            <div class="col-lg-9">
                <div class="card">
                    <div class="card-header bg-light">
                        <div class="d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">
                                <i class="fas fa-map-marked-alt text-success me-2"></i>
                                Mapa de Impacto Económico por Actividad Sísmica
                            </h5>
                            <div>
                                <button class="btn btn-sm btn-outline-success me-2">
                                    <i class="fas fa-download me-1"></i>Exportar Datos
                                </button>
                                <button class="btn btn-sm btn-success">
                                    <i class="fas fa-chart-bar me-1"></i>Ver Reportes
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="card-body p-0">
                        <div id="economiaMap" class="map-container"></div>
                    </div>
                </div>

                <!-- Tarjetas de Análisis Económico -->
                <div class="row mt-4">
                    <div class="col-md-3">
                        <div class="card text-center border-danger">
                            <div class="card-body">
                                <i class="fas fa-exclamation-triangle text-danger" style="font-size: 2rem;"></i>
                                <h5 class="mt-3">PIB en Alto Riesgo</h5>
                                <h3 class="text-danger">$625B</h3>
                                <p class="text-muted">25% del PIB nacional expuesto</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-center border-warning">
                            <div class="card-body">
                                <i class="fas fa-industry text-warning" style="font-size: 2rem;"></i>
                                <h5 class="mt-3">Sectores Vulnerables</h5>
                                <h3 class="text-warning">48%</h3>
                                <p class="text-muted">manufactura en zonas sísmicas</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-center border-info">
                            <div class="card-body">
                                <i class="fas fa-chart-line text-info" style="font-size: 2rem;"></i>
                                <h5 class="mt-3">Pérdidas Potenciales</h5>
                                <h3 class="text-info">$15B</h3>
                                <p class="text-muted">estimado por sismo mayor</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-center border-success">
                            <div class="card-body">
                                <i class="fas fa-shield-alt text-success" style="font-size: 2rem;"></i>
                                <h5 class="mt-3">PIB Protegido</h5>
                                <h3 class="text-success">$1T</h3>
                                <p class="text-muted">en zonas de bajo riesgo</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tabla de Estados -->
                <div class="card mt-4">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0"><i class="fas fa-table me-2"></i>Ranking de Estados por Vulnerabilidad Económica</h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Ranking</th>
                                        <th>Estado</th>
                                        <th>PIB</th>
                                        <th>Riesgo Sísmico</th>
                                        <th>Vulnerabilidad</th>
                                        <th>Pérdida Estimada</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><span class="badge bg-danger">1</span></td>
                                        <td><strong>Oaxaca</strong></td>
                                        <td>$45B</td>
                                        <td><span class="badge bg-danger">Alto</span></td>
                                        <td><span class="badge bg-danger">Muy Alta</span></td>
                                        <td class="text-danger">$2.2B</td>
                                    </tr>
                                    <tr>
                                        <td><span class="badge bg-warning">2</span></td>
                                        <td><strong>Guerrero</strong></td>
                                        <td>$38B</td>
                                        <td><span class="badge bg-danger">Alto</span></td>
                                        <td><span class="badge bg-warning">Alta</span></td>
                                        <td class="text-danger">$1.9B</td>
                                    </tr>
                                    <tr>
                                        <td><span class="badge bg-warning">3</span></td>
                                        <td><strong>Chiapas</strong></td>
                                        <td>$42B</td>
                                        <td><span class="badge bg-warning">Moderado</span></td>
                                        <td><span class="badge bg-warning">Alta</span></td>
                                        <td class="text-warning">$1.7B</td>
                                    </tr>
                                    <tr>
                                        <td><span class="badge bg-info">4</span></td>
                                        <td><strong>Michoacán</strong></td>
                                        <td>$67B</td>
                                        <td><span class="badge bg-warning">Moderado</span></td>
                                        <td><span class="badge bg-info">Media</span></td>
                                        <td class="text-warning">$2.3B</td>
                                    </tr>
                                    <tr>
                                        <td><span class="badge bg-success">5</span></td>
                                        <td><strong>Jalisco</strong></td>
                                        <td>$185B</td>
                                        <td><span class="badge bg-success">Bajo</span></td>
                                        <td><span class="badge bg-success">Baja</span></td>
                                        <td class="text-success">$0.8B</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Inicializar mapa económico
        const economiaMap = L.map('economiaMap').setView([23.6345, -102.5528], 5);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '© OpenStreetMap contributors'
        }).addTo(economiaMap);

        // Datos económicos por estado
        const economiaData = [
            { nombre: 'Oaxaca', lat: 17.0732, lng: -96.7266, pib: 45, riesgo: 'alto', vulnerabilidad: 'muy alta' },
            { nombre: 'Guerrero', lat: 17.4391, lng: -99.5451, pib: 38, riesgo: 'alto', vulnerabilidad: 'alta' },
            { nombre: 'Chiapas', lat: 16.7569, lng: -93.1292, pib: 42, riesgo: 'moderado', vulnerabilidad: 'alta' },
            { nombre: 'Michoacán', lat: 19.5665, lng: -101.7068, pib: 67, riesgo: 'moderado', vulnerabilidad: 'media' },
            { nombre: 'Ciudad de México', lat: 19.4326, lng: -99.1332, pib: 425, riesgo: 'moderado', vulnerabilidad: 'media' },
            { nombre: 'Jalisco', lat: 20.6595, lng: -103.3494, pib: 185, riesgo: 'bajo', vulnerabilidad: 'baja' },
            { nombre: 'Nuevo León', lat: 25.6866, lng: -100.3161, pib: 198, riesgo: 'bajo', vulnerabilidad: 'baja' },
            { nombre: 'Puebla', lat: 19.0414, lng: -98.2063, pib: 92, riesgo: 'moderado', vulnerabilidad: 'media' }
        ];

        // Función para obtener color según vulnerabilidad
        function getVulnerabilityColor(vulnerabilidad) {
            switch(vulnerabilidad) {
                case 'muy alta': return '#8b0000';
                case 'alta': return '#e74c3c';
                case 'media': return '#f39c12';
                case 'baja': return '#27ae60';
                default: return '#95a5a6';
            }
        }

        // Función para obtener tamaño según PIB
        function getPIBRadius(pib) {
            return Math.sqrt(pib / 10) * 3;
        }

        // Agregar marcadores económicos
        economiaData.forEach(function(estado) {
            const radius = getPIBRadius(estado.pib);
            const color = getVulnerabilityColor(estado.vulnerabilidad);
            
            const circle = L.circleMarker([estado.lat, estado.lng], {
                color: color,
                fillColor: color,
                fillOpacity: 0.7,
                radius: radius,
                weight: 3
            }).addTo(economiaMap);

            // Popup con información económica
            circle.bindPopup(`
                <div class="text-center">
                    <h6><strong>${estado.nombre}</strong></h6>
                    <p class="mb-1"><i class="fas fa-dollar-sign"></i> PIB: $${estado.pib}B</p>
                    <p class="mb-1"><i class="fas fa-exclamation-triangle"></i> Riesgo: ${estado.riesgo}</p>
                    <p class="mb-1"><i class="fas fa-shield-alt"></i> Vulnerabilidad: ${estado.vulnerabilidad}</p>
                    <span class="badge" style="background-color: ${color};">${estado.vulnerabilidad.toUpperCase()}</span>
                </div>
            `);
        });

        // Leyenda económica
        const economicLegend = L.control({position: 'bottomright'});
        economicLegend.onAdd = function (map) {
            const div = L.DomUtil.create('div', 'info legend');
            div.style.backgroundColor = 'white';
            div.style.padding = '10px';
            div.style.borderRadius = '5px';
            div.style.boxShadow = '0 2px 5px rgba(0,0,0,0.2)';
            
            div.innerHTML = `
                <h6><strong>Vulnerabilidad Económica</strong></h6>
                <i style="background: #8b0000; width: 18px; height: 18px; display: inline-block; border-radius: 50%; margin-right: 8px;"></i> Muy Alta<br>
                <i style="background: #e74c3c; width: 18px; height: 18px; display: inline-block; border-radius: 50%; margin-right: 8px;"></i> Alta<br>
                <i style="background: #f39c12; width: 18px; height: 18px; display: inline-block; border-radius: 50%; margin-right: 8px;"></i> Media<br>
                <i style="background: #27ae60; width: 18px; height: 18px; display: inline-block; border-radius: 50%; margin-right: 8px;"></i> Baja<br>
                <small>El tamaño indica el PIB del estado</small>
            `;
            return div;
        };
        economicLegend.addTo(economiaMap);

        // Gráfico de pérdidas económicas
        const ctx = document.getElementById('economicChart').getContext('2d');
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['2020', '2021', '2022', '2023', '2024'],
                datasets: [{
                    label: 'Pérdidas (Billones $)',
                    data: [1.2, 0.8, 2.1, 1.5, 0.9],
                    backgroundColor: 'rgba(231, 76, 60, 0.8)',
                    borderColor: 'rgba(231, 76, 60, 1)',
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Billones USD'
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });
    </script>
</body>
</html>